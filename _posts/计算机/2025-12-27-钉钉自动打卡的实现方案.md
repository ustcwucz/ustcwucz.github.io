---
layout: post
title: 打工人的福音
subtitle: 钉钉自动打卡
cover-img: 
thumbnail-img: 
share-img: 
tags: ["计算机","python","自动化","生活"]
author: 汁汁
math: false
---

# 钉钉自动打卡：从原理到实践

## 一、前言

### 1. 背景

入冬以来，尤其是最近两个星期气温骤降，汁汁每天都起不来床，一定要在床上玩二十分钟的手机才能清醒过来，所以总是在极限时间出门，卡点到学校里打卡，上周已经迟到两次了。

### 2. 目的

为了准时考勤 ~~和多睡懒觉~~ ，汁汁决定 ~~早点起床~~ 制作打卡脚本。

### 3. 成果

直接收获：一个成功的上班打卡脚本 + 考勤永远不会迟到

间接收获：每天多睡20min + 提早下班（时间看心情）

---

## 二、技术简介

### 1. 方案对比

#### 方案一：按键精灵

+ 优势：按键精灵简单易用，可以通过录制操作、拖拽控件，不需要任何编程知识就能做出脚本。

+ 缺点：钉钉能检测出程序模拟的操作与真人手指操作之间存在的的差异。

#### 方案二：ToDesk 移动版

+ 优势：随时可以远程控制手机，和用手操控手机一样。
+ 缺点：同按键精灵一样会被检测，另外需要稳定网络以及开通会员。

#### 方案三：ToDeskPC版 + Scrcpy

+ 优势：通过PC远程控制真实手机，所有操作均为系统级真实触摸事件，安全性最高。
+ 缺点：需要开启手机USB调试模式，对新手有一定门槛。

#### 方案四：pyAutoGui + Scrcpy

+ 优势：全自动、定时完成打卡任务。
+ 缺点：需要具备Python编程能力。

### 2. 核心技术简介

+ pyAutoGui

  一个用于自动化计算机行为的python库，可以用来操作鼠标和键盘。

+ Scrcpy

  一款易用的 Android 屏幕镜像工具，能够将安卓设备屏幕镜像到电脑上。

---

## 三、环境搭建

### 1. 准备硬件

Windows电脑、安卓手机、USB数据线

#### 2.1 安装Python

1. 访问 [Python官网](https://www.python.org/downloads/)
2. 下载最新版本的Python安装包（建议Python 3.8以上）
3. 安装时务必勾选 **"Add Python to PATH"**
4. 验证安装是否成功：
   ```bash
   python --version
   # 应显示类似：Python 3.9.13
   ```

#### 2.2 安装pyAutoGui库
1. 打开命令提示符或PowerShell
2. 安装pyautogui及其依赖：
   ```bash
   pip install pyautogui
   ```
3. 测试安装是否成功：
   ```python
   python -c "import pyautogui; print(pyautogui.__version__)"
   ```

#### 2.3 安装Scrcpy
1. **下载Scrcpy**：
   - 访问 [Scrcpy的GitHub发布页面](https://github.com/Genymobile/scrcpy/releases) 或者 [下载 SCRCPY | Scrcpy](https://scrcpyapp.org/download/)
2. **解压文件**：
   - 将下载的zip文件解压到合适的位置，例如：`C:\Program Files\scrcpy\`
   - 记住这个路径，后续代码中需要用到
3. **添加环境变量（可选但推荐）**：
   - 右键点击"此电脑" → 属性 → 高级系统设置 → 环境变量
   - 在系统变量的Path中添加Scrcpy的bin目录路径

### 3. 连接测试

#### 3.1 开启手机USB调试
1. **开启开发者选项**：
   - 进入手机"设置" → "关于手机"
   - 连续点击"版本号"7次，直到看到"您已处于开发者模式"的提示

2. **启用USB调试**：
   - 返回设置 → 开发者选项
   - 找到"USB调试"并开启

3. **设置USB用途**：
   - 连接手机时，选择"传输文件(MTP)"模式
   - 在USB调试选项下，勾选"一律允许使用这台计算机进行调试"

#### 3.2 使用Scrcpy控制手机
1. **连接手机**：
   - 使用USB数据线连接手机和电脑
   - 手机上允许USB调试请求

2. **启动Scrcpy**：
   
   ```bash
   # 如果添加了环境变量
   scrcpy
   
   # 如果没有添加环境变量
   C:\Program Files\scrcpy\scrcpy.exe
   ```
   
4. **验证连接成功**：
   
   - 电脑上应该出现手机的镜像屏幕
   - 可以用鼠标在电脑上操作手机
   - 键盘输入应该能在手机上响应

---

## 四、实践

### 模块一：检测时间和程序休眠

```python
def get_time():
    now = datetime.datetime.now()
    current_h = now.hour
    current_m = now.minute
    current_s = now.second
    print(current_h ,":", current_m ,":", current_s)
if(current_h < 7):
    print("before 7:00 , too early")
    keep_sleep = True
elif(current_h == 7):
    print("7:00 - 8:00")
    if(current_m < 30):
        keep_sleep = True
    else:
        print("clock in") # 7:30 - 8:00
        keep_sleep = False
elif(current_h < 11):
    print("8:00 - 11:00")
    keep_sleep = True
elif(current_h == 11):
    print("11:00 - 12:00")
    if(current_m < 30):
        keep_sleep = True
    else:
        print("clock out") # 11:30 - 12:00
        keep_sleep = False
elif(current_h == 12):
    print("12:00 - 13:00")
    if(current_m <= 30):
        keep_sleep = True
    else:
        print("clock in") # 12:31 - 13:00
        keep_sleep = False
elif(current_h < 16):
    print("13:00 - 16:00")
    keep_sleep = True
elif(current_h == 16):
    print("16:00 - 17:00")
    if(current_m < 30):
        keep_sleep = True
    else:
        print("clock out") # 16:30 - 17:00
        keep_sleep = False
else:
    print("after 17:00 , too late")
    keep_sleep = True
return(keep_sleep)
```

```python
def sleep(sleep_time = 300):
    print('waiting')
    time.sleep(sleep_time)
```

### 模块二：打开Scrcpy

```python
def open_scrcpy(scrcpy_adress):
    pyautogui.hotkey('win', 'r')
    time.sleep(1)
    
    pyautogui.write(scrcpy_adress)
    time.sleep(1)
    
    pyautogui.press('enter')
    print(f"success")
```

### 模块三：操作手机

```python
def open_phone():
    time.sleep(10)
    pyautogui.moveTo(x = 960, y = 800)
    time.sleep(1)
    pyautogui.click(button='right')
    time.sleep(1)
    pyautogui.drag(xOffset = 0, yOffset = -200, duration = 0.5)
```

```python
def operate():
    #back to home
    time.sleep(1)
    pyautogui.moveTo(x = 1055, y = 980)
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()
    
    #opendingding
    time.sleep(1)
    pyautogui.moveTo(x = 960, y = 555)
    time.sleep(1)
    pyautogui.click()

    #click clock in
    time.sleep(5)
    pyautogui.moveTo(x = 1040, y = 203)
    time.sleep(1)
    pyautogui.click()

    #press button
    time.sleep(10)
    pyautogui.moveTo(x = 960, y = 625)
    time.sleep(1)
    pyautogui.click()

    #back to home
    time.sleep(1)
    pyautogui.moveTo(x = 1055, y = 980)
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()
    time.sleep(1)
    pyautogui.click()

    #exit
    time.sleep(1)
    pyautogui.moveTo(x = 1138, y = 61)
    time.sleep(1)
    pyautogui.click()
```

### 模块四：主函数和调用库

```python
import pyautogui
import time
import datetime
```

```python
if __name__ == "__main__":
    while(True):
        keep_sleep = get_time()
        while(keep_sleep):
            sleep(5 * 60)
            keep_sleep = get_time()
        path = r'C:\Program Files\scrcpy-win64-v3.3.3\scrcpy-win64-v3.3.3\scrcpy.exe'
        open_scrcpy(path)
        time.sleep(3)
        open_phone()
        time.sleep(3)
        operate()
        sleep(30 * 60)
```
